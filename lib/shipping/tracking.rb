# coding: utf-8
module Shipping
  module Tracking

    # not even using this ATM as I might be able to short-circuit the lookup using what's in the wombat payload already
    SHIPPING_CARRIERS = JSON.parse '[{"name":"UPS","code":"ups","accountNumber":"W41E77","requiresFundedAccount":false,"balance":0.0},{"name":"FedEx","code":"fedex","accountNumber":"501411264","requiresFundedAccount":false,"balance":0.0},{"name":"Endicia","code":"endicia","accountNumber":"850861","requiresFundedAccount":true,"balance":8680.89},{"name":"DHL Global Mail","code":"dhl_global_mail","accountNumber":"5324121","requiresFundedAccount":false,"balance":0.0}]'

    # has keys for each carrier
    # not even using this ATM as I might be able to short-circuit the lookup using what's in the wombat payload already
    SHIPPING_SERVICES = JSON.parse '[{"fedex" : [{"carrierCode":"fedex","code":"fedex_ground","name":"FedEx Ground®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_home_delivery","name":"FedEx Home Delivery®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_2day","name":"FedEx 2Day®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_2day_am","name":"FedEx 2Day® A.M.","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_express_saver","name":"FedEx Express Saver®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_standard_overnight","name":"FedEx Standard Overnight®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_priority_overnight","name":"FedEx Priority Overnight®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_first_overnight","name":"FedEx First Overnight®","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_smartpost_presorted_standard","name":"FedEx SmartPost Presorted Standard","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_smartpost_bound_printed_matter","name":"FedEx SmartPost® Bound Printed Matter","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_smartpost_media","name":"FedEx SmartPost® Media","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_smartpost_parcel_select","name":"FedEx SmartPost Parcel Select","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_smartpost_parcel_select_lightweight","name":"FedEx SmartPost Parcel Select Lightweight","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_smartpost_returns","name":"FedEx SmartPost® Returns","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_1_day_freight","name":"FedEx 1Day® Freight","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_2_day_freight","name":"FedEx 2Day® Freight","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_3_day_freight","name":"FedEx 3Day® Freight","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_first_overnight_freight","name":"FedEx First Overnight® Freight","domestic":true,"international":false},{"carrierCode":"fedex","code":"fedex_ground_international","name":"FedEx International Ground®","domestic":false,"international":true},{"carrierCode":"fedex","code":"fedex_international_economy","name":"FedEx International Economy®","domestic":false,"international":true},{"carrierCode":"fedex","code":"fedex_international_priority","name":"FedEx International Priority®","domestic":false,"international":true},{"carrierCode":"fedex","code":"fedex_international_first","name":"FedEx International First®","domestic":false,"international":true},{"carrierCode":"fedex","code":"fedex_international_economy_freight","name":"FedEx International Economy® Freight","domestic":false,"international":true},{"carrierCode":"fedex","code":"fedex_international_priority_freight","name":"FedEx International Priority® Freight","domestic":false,"international":true}],"endicia" : [{"carrierCode":"endicia","code":"usps_first_class_mail","name":"USPS First Class Mail","domestic":true,"international":false},{"carrierCode":"endicia","code":"usps_media_mail","name":"USPS Media Mail","domestic":true,"international":false},{"carrierCode":"endicia","code":"usps_parcel_select","name":"USPS Parcel Select","domestic":true,"international":false},{"carrierCode":"endicia","code":"usps_priority_mail","name":"USPS Priority Mail","domestic":true,"international":false},{"carrierCode":"endicia","code":"usps_priority_mail_express","name":"USPS Priority Mail Express","domestic":true,"international":false},{"carrierCode":"endicia","code":"usps_first_class_package_international","name":"USPS First Class Package Intl","domestic":false,"international":true},{"carrierCode":"endicia","code":"usps_first_class_mail_international","name":"USPS First Class Mail Intl","domestic":false,"international":true},{"carrierCode":"endicia","code":"usps_priority_mail_international","name":"USPS Priority Mail Intl","domestic":false,"international":true},{"carrierCode":"endicia","code":"usps_priority_mail_express_international","name":"USPS Priority Mail Express Intl","domestic":false,"international":true},{"carrierCode":"endicia","code":"international_priority_airmail","name":"International Priority Airmail","domestic":false,"international":true},{"carrierCode":"endicia","code":"international_surface_air_lift","name":"International Surface Air Lift","domestic":false,"international":true},{"carrierCode":"endicia","code":"consolidator_international","name":"Consolidator International","domestic":false,"international":true},{"carrierCode":"endicia","code":"globegistics_ipa","name":"Globegistics IPA","domestic":false,"international":true},{"carrierCode":"endicia","code":"globegistics_isal","name":"Globegistics ISAL","domestic":false,"international":true},{"carrierCode":"endicia","code":"globegistics_e-packet","name":"Globegistics E-Packet","domestic":false,"international":true}],"ups" : [{"carrierCode":"ups","code":"ups_ground","name":"UPS Ground","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_standard","name":"UPS Standard","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_3_day_select","name":"UPS 3 Day Select®","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_worldwide_express","name":"UPS Worldwide Express®","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_ground","name":"UPS Ground International","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_2nd_day_air","name":"UPS 2nd Day Air®","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_worldwide_express_plus","name":"UPS Worldwide Express Plus®","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_worldwide_expedited","name":"UPS Worldwide Expedited®","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_2nd_day_air_am","name":"UPS 2nd Day Air AM®","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_next_day_air_saver","name":"UPS Next Day Air Saver®","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_worldwide_saver","name":"UPS Worldwide Saver®","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_next_day_air","name":"UPS Next Day Air®","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_next_day_air_early_am","name":"UPS Next Day Air® Early AM®","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_next_day_air","name":"UPS Next Day Air International","domestic":false,"international":true},{"carrierCode":"ups","code":"ups_surepost_less_than_1_lb","name":"UPS SurePost® Less than 1 lb","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_surepost_1_lb_or_greater","name":"UPS SurePost® 1 lb or Greater","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_surepost_bpm","name":"UPS SurePost® BPM","domestic":true,"international":false},{"carrierCode":"ups","code":"ups_surepost_media","name":"UPS SurePost® Media","domestic":true,"international":false},{"carrierCode":"ups","code":"expedited_mail_innovations","name":"Expedited Mail Innovations","domestic":true,"international":false},{"carrierCode":"ups","code":"priority_mail_innovations","name":"Priority Mail Innovations","domestic":false,"international":true},{"carrierCode":"ups","code":"economy_mail_innovations","name":"Economy Mail Innovations","domestic":false,"international":true},{"carrierCode":"ups","code":"mail_innovations_priority_mail","name":"Mail Innovations - Priority Mail","domestic":true,"international":false},{"carrierCode":"ups","code":"mail_innovations_first_class","name":"Mail Innovations - First Class","domestic":true,"international":false}],  "dhl_global_mail" : [{"carrierCode":"dhl_global_mail","code":"smartmail_parcels_ground","name":"Smartmail Parcels Ground","domestic":true,"international":false},{"carrierCode":"dhl_global_mail","code":"smartmail_parcel_plus_ground","name":"Smartmail Parcel Plus Ground","domestic":true,"international":false},{"carrierCode":"dhl_global_mail","code":"smartmail_parcel_plus_expedited","name":"Smartmail Parcel Plus Expedited","domestic":true,"international":false},{"carrierCode":"dhl_global_mail","code":"smartmail_parcels_expedited","name":"Smartmail Parcels Expedited","domestic":true,"international":false},{"carrierCode":"dhl_global_mail","code":"globalmail_business_priority","name":"Globalmail Business Priority","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_business_standard","name":"Globalmail Business Standard","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_priority","name":"Globalmail Packet Priority","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_standard","name":"Globalmail Packet Standard","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_plus","name":"Globalmail Packet Plus","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_ipa","name":"Globalmail Packet IPA","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_isal","name":"Globalmail Packet ISAL","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_priority_ws_option","name":"Globalmail Packet Priority - WS Option","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_packet_standard_ws_option","name":"Globalmail Packet Standard - WS Option","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_parcel_priority","name":"Globalmail Parcel Priority","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_parcel_standard","name":"Globalmail Parcel Standard","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_parcel_direct_ddp","name":"Globalmail Parcel Direct - DDP","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_parcel_direct_ddu","name":"Globalmail Parcel Direct - DDU","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_parcel_direct_express_ddp","name":"Globalmail Parcel Direct Express - DDP","domestic":false,"international":true},{"carrierCode":"dhl_global_mail","code":"globalmail_parcel_direct_express_ddu","name":"Globalmail Parcel Direct Express - DDU","domestic":false,"international":true}]}]'

    TRACKING_URLS = {
      15 => 'http://www.shipmentmanager.com/Portal.aspx?MerchantID=1900&TargetPageID=38&TrackingKey=BID&TrackingIdentifier=',
      5 => 'http://tracking.asendiausa.com/TrackV2.aspx?c=16263&p=', # Endicia is equivalent to Asendia in our shipstation
      8 => 'https://tools.usps.com/go/TrackConfirmAction_input?qtc_tLabels1=', #USPS
      4 => 'http://www.fedex.com/Tracking?action=track&tracknumbers=', # FedEx
      9 => 'http://www.fedex.com/Tracking?action=track&tracknumbers=', # FedEx International MailService
      12 => 'http://www.fedex.com/Tracking?action=track&tracknumbers=' # FecEx Canada
    }

    SHIPSTATION_SERVICE_CODE_TO_PROVIDER_LOOKUP = {
      'usps_first_class_mail' => 8,
      'usps_priority_mail' => 8,
      'usps_first_class_package_international' => 8,
      'fedex_smartpost_parcel_select_lightweight' => 4,
      'fedex_smartpost_parcel_select' => 4,
      'international_priority_airmail' => 5,
      'consolidator_international' => 5
    }

    def self.tracking_url(service_code, tracking_number)
      if tracking_url_key = SHIPSTATION_SERVICE_CODE_TO_PROVIDER_LOOKUP[service_code.downcase]
        TRACKING_URLS[tracking_url_key] + "#{tracking_number}"
      else
        Rails.logger.error "Tracking Service Code Lookup Failure: #{service_code}" # this means our list above is incomplete and we'll need to ask the fulfillment team
        nil
      end
    end
  end
end
